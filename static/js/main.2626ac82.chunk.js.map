{"version":3,"sources":["assets/0.png","assets/1.png","assets/2.png","tile.js","camera.js","assets/buttons/buttons.png","assets/backgrounds/bg_world.gif","pixicomponent.js","board.js","load.js","index.js"],"names":["Tile","tileSprite","tile0","opacity","this","props","saturation","value","tile1","tile2","src","alt","width","config","TILESIZE","camera","zoom","height","style","position","filter","zIndex","top","left","React","PureComponent","Camera","x","INIT_X","y","INIT_Y","speed","min_zoom","max_zoom","angle","PixiComponent","state","tiles","isBuilding","app","PIXI","window","innerWidth","innerHeight","backgroundAlpha","resolution","devicePixelRatio","document","body","appendChild","view","renderBackground","container","sortableChildren","stage","addChild","texture0","from","texture1","loader","add","load","renderButtons","renderTilemap","border","lineStyle","drawRect","screen","interactive","on","e","onMouseDown","onMouseUp","onMouseMove","addEventListener","resize","renderer","onWheel","ticker","delta","update","block","removeChildren","updateProjection","renderProjection","stop","j","BOARD_SIZE","i","Vec2D","bgTex","background","bgSprite","baseTexture","btnSheet","sheet","btnSheetJson","parse","Object","keys","textures","map","t","buildingBtn","buttonMode","rotateAntiBtn","centerBtn","rotateBtn","stopPropagation","tint","onBuildingBtn","onRotateAntiBtn","onCenterBtn","onRotateBtn","tile","selectedTile","alpha","blendMode","scale","tZ","dX","getBoardCenter","dY","dTileX","Math","round","dTileY","dInitY","ceil","centerTile","nCols","nRows","minI","maxI","minJ","maxJ","component","ref","thisDiv","gameCanvas","oldW","oldH","deltaW","deltaH","clear","BuildBlock","placeI","placeJ","NORMAL","Board","handleMouseClick","event","type","setState","isMouseDown","eX","data","global","eY","lastX","lastY","lastDragX","lastDragY","performance","now","dT","lastClick","handleDoubleClick","handleClick","isDragging","isNewBoard","loadTiles","center","slice","floor","length","assign","offX","offY","button","buttons","mousePos","lastDrag","offset","subtract","updateCamera","placeBlock","direction","matrix","oldCenterX","getCenter","n","tmp","xOffset","idx","convertToMap","topFactor","getTopFactor","console","log","screenX","screenY","limit","TILESIZE_Z","TILE_HALF","trunc","tx","cx","cy","tcy","tcx","offsetY","abs","key","mX","oldI","oldJ","Infinity","isAtCorner","ADD","hasNeighbour","right","up","down","upLeft","upRight","downLeft","downRight","scroll","deltaY","oldZoom","newZoom","oldHeight","dH","className","bind","toggleBuild","rotate","forceUpdate","removeEventListener","Component","code","onmessage","cmd","PROGRESS_BOARD_LOAD","rows","columns","defaultValue","Uint8Array","count","cProgress","self","postMessage","buffer","toString","substring","indexOf","lastIndexOf","blob","Blob","worker_script","URL","createObjectURL","STATE_LOADING","STATE_RUNNING","Game","overflow","preventDefault","loadProgress","loadText","current","loadBoard","arr","cols","push","Worker","boardWorker","Config","progress","matrixify","content","renderLoadingScreen","renderBoard","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.2626ac82.chunk.js","sourcesContent":["export default \"data:image/png;base64,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\"","export default \"data:image/png;base64,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\"","export default __webpack_public_path__ + \"static/media/2.3b93bd89.png\";","import React from 'react';\r\nimport config from './config.json';\r\nimport tile0 from './assets/0.png';\r\nimport tile1 from './assets/1.png';\r\nimport tile2 from './assets/2.png';\r\n\r\n/**\r\n * Pure component tile class responsible for\r\n * rendering tiles into the game board\r\n */\r\nexport default class Tile extends React.PureComponent {\r\n\r\n    render() {\r\n        var tileSprite = tile0;\r\n        var opacity = this.props.opacity === null ? 1 : this.props.opacity;\r\n        var saturation = this.props.saturation === null ? 1 : this.props.saturation;\r\n    \r\n        if(this.props.value === 0)\r\n        return (null);\r\n        if (this.props.value % 2 === 0)\r\n            tileSprite = tile1;\r\n        else if (this.props.value % 3 === 0)\r\n            tileSprite = tile2;\r\n    \r\n        return (\r\n            <img src={tileSprite} \r\n            alt=\"iso tile\" \r\n            width={config.TILESIZE*this.props.camera.zoom}\r\n            height={config.TILESIZE*this.props.camera.zoom}\r\n            style={{\r\n            opacity: opacity,\r\n            position: 'absolute', \r\n            filter: 'saturate('+saturation+')',\r\n            zIndex: this.props.zIndex,\r\n            top: this.props.top, \r\n            left: this.props.left}}\r\n            />\r\n        );\r\n    }\r\n}","import config from './config.json'\r\n\r\n/**\r\n * Camera class for board camera operations\r\n */\r\n export default class Camera {\r\n    x = config.INIT_X;  // current x position of the camera\r\n    y = config.INIT_Y; // current y position of the camera\r\n    speed = 1; // camera speed\r\n    zoom = 1; // current zoom of the camera to the board\r\n    width = 4; // camera width in tiles\r\n    height = 4; // camera height in tiles\r\n    min_zoom = 0.5; // camera height in tiles\r\n    max_zoom = 2; // camera max zoom\r\n    angle = 0; // current camera angle (from 0 to 3 (0, 90, 180 and 270 degrees))\r\n }\r\n","export default __webpack_public_path__ + \"static/media/buttons.c096f3b1.png\";","export default __webpack_public_path__ + \"static/media/bg_world.4fae2a5e.gif\";","import * as React from 'react';\r\nimport * as PIXI from 'pixi.js';\r\nimport tile0 from './assets/0.png';\r\nimport btnSheet from './assets/buttons/buttons.png';\r\nimport btnSheetJson from './assets/buttons/buttons.json';\r\nimport tile1 from './assets/1.png';\r\nimport config from './config.json';\r\nimport * as Vec2D from 'vector2d';\r\nimport background from './assets/backgrounds/bg_world.gif';\r\n\r\nexport class PixiComponent extends React.Component {\r\n  /**\r\n   * After mounting, add the Pixi Renderer to the div and start the Application.\r\n   */\r\n  componentDidMount() {\r\n    this.camera = this.props.state.camera;\r\n    this.tiles = this.props.state.tiles;\r\n    this.isBuilding = this.props.state.isBuilding;\r\n\r\n    this.app = new PIXI.Application({ \r\n      width: window.innerWidth*0.70, height: window.innerHeight*0.95, \r\n      backgroundAlpha: 0, resolution: window.devicePixelRatio || 1\r\n  });\r\n    document.body.appendChild(this.app.view);\r\n    this.app.view.style.position = 'absolute';this.app.view.style.left = '20px';this.app.view.style.top = '20px';\r\n\r\n    // creates and renders background\r\n    this.renderBackground();\r\n    // create tiles and sprites container\r\n    this.container = new PIXI.Container();\r\n    this.container.sortableChildren = true;\r\n    this.app.stage.addChild(this.container);\r\n    \r\n    // Create a new texture\r\n    this.texture0 = PIXI.Texture.from(tile0);\r\n    this.texture1 = PIXI.Texture.from(tile1);\r\n\r\n    // loads buttons spritesheet and render them when loading is complete\r\n    this.loader = new PIXI.Loader();\r\n    this.loader.add(\"./assets/buttons/buttons.json\").load(this.renderButtons());\r\n\r\n    // renders tilemap\r\n    this.renderTilemap();\r\n\r\n    // border\r\n    this.border = new PIXI.Graphics();\r\n\r\n    // set the line style to have a width of 5 and set the color to red\r\n    this.border.lineStyle(2, 0x000000);\r\n\r\n    // draw a rectangle border\r\n    this.border.drawRect(this.app.screen.x, this.app.screen.y+1, this.app.screen.width-1, this.app.screen.height-2);\r\n    this.app.stage.addChild(this.border);\r\n\r\n    // mouse interation callbacks\r\n    this.app.stage.interactive = true;\r\n    this.app.stage.on(\"pointerdown\", (e) => this.props.onMouseDown(e));\r\n    this.app.stage.on(\"pointerup\", (e) => this.props.onMouseUp(e));\r\n    this.app.stage.on(\"pointermove\", (e) => this.props.onMouseMove(e));\r\n    //window.addEventListener(\"wheel\", (e) => this.props.onWheel(e));\r\n    window.addEventListener('resize', (e) => this.resize());\r\n    this.app.renderer.view.addEventListener('wheel', (e) => this.props.onWheel(e));\r\n    \r\n    // Listen for animate update\r\n    this.app.ticker.add((delta) => {\r\n      this.update(delta);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Perform updates based on changes that happened since last tick\r\n   * @param {delta} delta the delta time from last tick\r\n   */\r\n  update(delta) {\r\n    // updates data sent via props\r\n    this.camera = this.props.state.camera;\r\n    this.tiles = this.props.state.tiles;\r\n    this.isBuilding = this.props.state.isBuilding;\r\n    this.block = this.props.state.block;\r\n\r\n    // clears container\r\n    this.container.removeChildren();\r\n    // start rendering \r\n    this.renderTilemap(); // render tilemap\r\n    if(this.isBuilding) { // if it is in building mode\r\n      this.props.updateProjection(); // updates projection via props method\r\n      this.renderProjection(); // render projection\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Stop the Application when unmounting.\r\n   */\r\n  componentWillUnmount() {\r\n    this.app.stop();\r\n  }\r\n  /**\r\n   * Returns a Vec2D with the coordinates to center isometric map with camera at 0\r\n   */\r\n  getBoardCenter() {\r\n    let j = config.BOARD_SIZE;\r\n    let i = config.BOARD_SIZE;\r\n    return new Vec2D.Vector(this.app.screen.width/2 - config.TILESIZE*this.camera.zoom/2 \r\n                                                      - (j-i)*(config.TILESIZE*this.camera.zoom/2)/2, \r\n                                                      this.app.screen.height*0.95/2 - (i+j)*(config.TILESIZE*this.camera.zoom/4)/2);\r\n  }\r\n\r\n  // create and renders background\r\n  renderBackground() {\r\n    // first set the texture\r\n    this.bgTex = new PIXI.Texture.from(background);\r\n    // create the sprite\r\n    this.bgSprite = new PIXI.Sprite(this.bgTex);\r\n    // set the width of the sprite\r\n    this.bgSprite.width = this.app.screen.width;\r\n    this.bgSprite.height = this.app.screen.height;\r\n    // finally add the new sprite\r\n    this.app.stage.addChild(this.bgSprite);\r\n  }\r\n\r\n  // create and renders buttons\r\n  renderButtons() {\r\n    // builds buttons spritesheet\r\n    const baseTexture = PIXI.BaseTexture.from(btnSheet);\r\n    const sheet = new PIXI.Spritesheet(baseTexture, btnSheetJson);\r\n    sheet.parse(() => {\r\n      Object.keys(sheet.textures).map((t) => sheet.textures[t]);\r\n    });\r\n    // create the building btn sprite\r\n    this.buildingBtn = new PIXI.Sprite(sheet.textures[\"test.png\"]);\r\n    this.buildingBtn.interactive = true;\r\n    this.buildingBtn.buttonMode = true;\r\n    // create the rotate anticlockwise btn sprite\r\n    this.rotateAntiBtn = new PIXI.Sprite(sheet.textures[\"LeftArrow (1).png\"]);\r\n    this.rotateAntiBtn.interactive = true;\r\n    this.rotateAntiBtn.buttonMode = true;\r\n    // create the center btn sprite\r\n    this.centerBtn = new PIXI.Sprite(sheet.textures[\"Home (1).png\"]);\r\n    this.centerBtn.interactive = true;\r\n    this.centerBtn.buttonMode = true;\r\n    // create the rotate clockwise btn sprite\r\n    this.rotateBtn = new PIXI.Sprite(sheet.textures[\"RightArrow (1).png\"]);\r\n    this.rotateBtn.interactive = true;\r\n    this.rotateBtn.buttonMode = true;\r\n    // set the position and dimensions \r\n    this.buildingBtn.position.x = 30;\r\n    this.buildingBtn.position.y = 30;\r\n    this.buildingBtn.width = 30;\r\n    this.buildingBtn.height = 30;\r\n\r\n    this.rotateAntiBtn.position.x = this.buildingBtn.position.x + this.buildingBtn.width + 10;\r\n    this.rotateAntiBtn.position.y = this.buildingBtn.position.y;\r\n    this.rotateAntiBtn.width = 30;\r\n    this.rotateAntiBtn.height = 30;\r\n\r\n    this.centerBtn.position.x = this.rotateAntiBtn.position.x + this.buildingBtn.width + 10;\r\n    this.centerBtn.position.y = this.rotateAntiBtn.position.y;\r\n    this.centerBtn.width = 30;\r\n    this.centerBtn.height = 30;\r\n    \r\n    this.rotateBtn.position.x = this.centerBtn.position.x + this.buildingBtn.width + 10;\r\n    this.rotateBtn.position.y = this.centerBtn.position.y;\r\n    this.rotateBtn.width = 30;\r\n    this.rotateBtn.height = 30;\r\n    // set the callbacks\r\n    this.buildingBtn.on(\"pointerdown\", (e) => {e.stopPropagation(); this.buildingBtn.tint=0x1FC012});\r\n    this.buildingBtn.on(\"pointerout\", (e) => {e.stopPropagation(); this.buildingBtn.tint=0xFFFFFF});\r\n    this.buildingBtn.on(\"pointerup\", (e) => {e.stopPropagation(); this.buildingBtn.tint=0xFFFFFF});\r\n    this.buildingBtn.on(\"click\", (e) => this.props.onBuildingBtn(e));\r\n\r\n    this.rotateAntiBtn.on(\"pointerdown\", (e) => {e.stopPropagation(); this.rotateAntiBtn.tint=0x1FC012});\r\n    this.rotateAntiBtn.on(\"pointerout\", (e) => {e.stopPropagation(); this.rotateAntiBtn.tint=0xFFFFFF});\r\n    this.rotateAntiBtn.on(\"pointerup\", (e) => {e.stopPropagation(); this.rotateAntiBtn.tint=0xFFFFFF});\r\n    this.rotateAntiBtn.on(\"click\", (e) => this.props.onRotateAntiBtn(e));\r\n\r\n    this.centerBtn.on(\"pointerdown\", (e) => {e.stopPropagation(); this.centerBtn.tint=0x1FC012});\r\n    this.centerBtn.on(\"pointerout\", (e) => {e.stopPropagation(); this.centerBtn.tint=0xFFFFFF});\r\n    this.centerBtn.on(\"pointerup\", (e) => {e.stopPropagation(); this.centerBtn.tint=0xFFFFFF});\r\n    this.centerBtn.on(\"click\", (e) => this.props.onCenterBtn(e));\r\n\r\n    this.rotateBtn.on(\"pointerdown\", (e) => {e.stopPropagation(); this.rotateBtn.tint=0x1FC012});\r\n    this.rotateBtn.on(\"pointerout\", (e) => {e.stopPropagation(); this.rotateBtn.tint=0xFFFFFF});\r\n    this.rotateBtn.on(\"pointerup\", (e) => {e.stopPropagation(); this.rotateBtn.tint=0xFFFFFF});\r\n    this.rotateBtn.on(\"click\", (e) => this.props.onRotateBtn(e));\r\n    // finally add the new button\r\n    this.app.stage.addChild(this.buildingBtn);\r\n    this.app.stage.addChild(this.rotateAntiBtn);\r\n    this.app.stage.addChild(this.centerBtn);\r\n    this.app.stage.addChild(this.rotateBtn);\r\n  }\r\n\r\n  /**\r\n   * Render projected tile for building blocks mode\r\n   */\r\n  renderProjection() {\r\n      // create and add tile to the container\r\n      const tile = this.block.selectedTile === 1 ? new PIXI.Sprite(this.texture1) : new PIXI.Sprite(this.texture0);\r\n      tile.zIndex = this.block.zIndex;\r\n      tile.x = this.block.x;\r\n      tile.y = this.block.y;\r\n      tile.alpha = this.block.alpha;\r\n      tile.blendMode = this.block.blendMode;\r\n      tile.tint = this.block.tint;\r\n      tile.scale.x = this.camera.zoom;\r\n      tile.scale.y = this.camera.zoom;\r\n      this.container.addChild(tile);\r\n  }\r\n\r\n  /**\r\n   * Do some culling directly on loop scope\r\n   * to render only visible tiles and renders them \r\n   */\r\n  renderTilemap() {\r\n    let tZ= config.TILESIZE*this.camera.zoom;\r\n    let dX = this.camera.x - this.getBoardCenter().x;\r\n    let dY = this.camera.y - this.getBoardCenter().y;\r\n    let dTileX = Math.round(dX / (tZ/2));\r\n    let dTileY = Math.round(dY / (tZ/2));\r\n    let dInitY = Math.ceil(config.BOARD_SIZE / (2));\r\n    let centerTile = [Math.round(config.BOARD_SIZE/2), Math.round(config.BOARD_SIZE/2)];\r\n    let nCols = Math.ceil(this.app.screen.width / (tZ/2))+3;\r\n    let nRows = Math.ceil(this.app.screen.height / (tZ/2))+4;\r\n    let minI = (centerTile[0]+centerTile[1]-dTileY-dInitY) - (Math.ceil(nRows/2)); let maxI = (centerTile[0]+centerTile[1]-dTileY-dInitY) + (Math.ceil(nRows/2));\r\n    let minJ = (centerTile[0]-centerTile[1]-dTileX) - (Math.ceil(nCols/2)); let maxJ = (centerTile[0]-centerTile[1]-dTileX) + (Math.ceil(nCols/2));\r\n\r\n    // loops only in the visible scope of tiles\r\n    for(let i = minI; i < maxI; i++) {\r\n      for(let j = minJ; j < maxJ; j++) {\r\n        let x = Math.round(i+j/2); // conversion to find the correct tile index visible\r\n        let y = Math.round(i-j/2); \r\n        // border control\r\n        if(x<0 || x>=config.BOARD_SIZE || y<0 || y>= config.BOARD_SIZE) continue;\r\n        // if its not in building mode and there is no tile, do not draw demarcation tiles \r\n        if(!this.isBuilding && this.tiles[y][x] === 0) continue;\r\n        // create and add tile to the container\r\n        const tile = this.tiles[y][x] === 1 ? new PIXI.Sprite(this.texture1) : new PIXI.Sprite(this.texture0);\r\n        tile.zIndex = y+x+2;\r\n        tile.x = (x-y)*(config.TILESIZE*this.camera.zoom/2) + this.camera.x;\r\n        tile.y = (y+x)*(config.TILESIZE*this.camera.zoom/4) + this.camera.y;\r\n        tile.alpha = this.tiles[y][x] === 1 ? 1 : 0.25;\r\n        tile.scale.x = this.camera.zoom;\r\n        tile.scale.y = this.camera.zoom;\r\n        this.container.addChild(tile);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Simply render the div that will contain the Pixi Renderer.\r\n   */\r\n  render() {\r\n    let component = this;\r\n    return (\r\n      <div ref={(thisDiv) => {component.gameCanvas = thisDiv}} />\r\n    );\r\n  }\r\n\r\n  // Resize the renderer when window resize happens\r\n  resize() {\r\n    // calculates delta in dimensions\r\n    let oldW = this.app.renderer.width;\r\n    let oldH = this.app.renderer.height;\r\n    let deltaW = Math.round(window.innerWidth*0.70) - oldW;\r\n    let deltaH = Math.round(window.innerHeight*0.95) - oldH;\r\n    // updates camera position\r\n    this.camera.x += deltaW/2;\r\n    this.camera.y += deltaH/2;\r\n    // resizes renderer\r\n    this.app.renderer.resize( window.innerWidth*0.70, window.innerHeight*0.95);\r\n    // resizes background\r\n    this.bgSprite.width = this.app.screen.width;\r\n    this.bgSprite.height = this.app.screen.height;\r\n    // resizes border\r\n    this.border.clear();\r\n    // set the line style to have a width of 5 and set the color to red\r\n    this.border.lineStyle(2, 0x000000);\r\n    this.border.drawRect(this.app.screen.x+1, this.app.screen.y+1, this.app.screen.width-1, this.app.screen.height-2);\r\n  }\r\n  \r\n}","import React from 'react';\r\nimport config from './config.json'\r\nimport Tile from './tile.js';\r\nimport Camera from './camera.js';\r\nimport * as Vec2D from 'vector2d';\r\nimport * as PIXI from 'pixi.js'\r\nimport { PixiComponent } from './pixicomponent.js';\r\n\r\n/**\r\n * Building block data\r\n */\r\nclass BuildBlock {\r\n  selectedTile = 1; // selected tile to build\r\n  x = 0; // the x position of building block;\r\n  y = 0; // the y position of building block;\r\n  placeI = null; // matrix index I to build block\r\n  placeJ = null; // matrix index J to build block\r\n  alpha = 0.5; // opacity of building block\r\n  zIndex = 2147483646; // the z-index of building block\r\n  blendMode = PIXI.BLEND_MODES.NORMAL; // the blend mode of building block\r\n  tint = 0xFFFFFF; // the color to apply tint over building block\r\n}\r\n\r\n/**\r\n * The component for the game board/map\r\n * responsible for operations related to the tilemap\r\n */\r\nclass Board extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      tiles: this.props.tiles,\r\n      x: 0, // mouse current X position\r\n      y: 0, // mouse current Y position\r\n      camera: new Camera(), // creates board camera\r\n      block: new BuildBlock(), // building block data\r\n      isMouseDown: false, // is a mouse button currently down\r\n      isDragging: false, // is the user currently dragging\r\n      isBuilding: false, // is the user currently in building mode\r\n      lastX: 0,\r\n      lastY: 0,\r\n      lastDragX: 0,\r\n      lastDragY: 0,\r\n      lastClick: 0,\r\n    };\r\n\r\n    // if its a new board, load initial disposition of blocks\r\n    if (this.props.isNewBoard)\r\n      this.loadTiles();\r\n\r\n    //centers camera\r\n    let center = this.getBoardCenter()\r\n    this.state.camera.x = center.x;\r\n    this.state.camera.y = center.y;\r\n  }\r\n\r\n  loadTiles() {\r\n    const tiles = this.state.tiles.slice();\r\n    tiles[Math.floor(config.BOARD_SIZE / 2)][Math.floor(config.BOARD_SIZE / 2)] = 1;\r\n    //tiles[config.BOARD_SIZE / 2 + 1][config.BOARD_SIZE / 2] = 1;\r\n   // tiles[config.BOARD_SIZE / 2 + 1][config.BOARD_SIZE / 2 + 1] = 1;\r\n  }\r\n\r\n  /**\r\n   * Returns a Vec2D with the coordinates to center isometric map with camera at 0\r\n   */\r\n  getBoardCenter() {\r\n    let j = config.BOARD_SIZE;\r\n    let i = config.BOARD_SIZE;\r\n    return new Vec2D.Vector(window.innerWidth * 0.70 / 2 - config.TILESIZE * this.state.camera.zoom / 2\r\n      - (j - i) * (config.TILESIZE * this.state.camera.zoom / 2) / 2,\r\n      window.innerHeight * 0.95 / 2 - (i + j) * (config.TILESIZE * this.state.camera.zoom / 4) / 2);\r\n  }\r\n\r\n  /**\r\n   * Position camera in order to position isometric tilemap \r\n   * in the center of the screen \r\n   */\r\n  center() {\r\n    let j = this.state.tiles[0].length;\r\n    let i = this.state.tiles.length;\r\n    let center = new Vec2D.Vector(window.innerWidth * 0.70 / 2 - config.TILESIZE * this.state.camera.zoom / 2\r\n      - (j - i) * (config.TILESIZE * this.state.camera.zoom / 2) / 2,\r\n      window.innerHeight * 0.95 / 2 - (i + j) * (config.TILESIZE * this.state.camera.zoom / 4) / 2)\r\n    const camera = Object.assign({}, this.state.camera);\r\n    camera.x = center.x;\r\n    camera.y = center.y;\r\n    this.setState({ camera: camera });\r\n  }\r\n\r\n  /**\r\n   * Get center coordinates of the isometric map current position\r\n   */\r\n  getCenter() {\r\n    let j = this.state.tiles[0].length;\r\n    let i = this.state.tiles.length;\r\n    let offX = (j - i) * (config.TILESIZE * this.state.camera.zoom / 2) / 2;\r\n    let offY = (i + j) * (config.TILESIZE * this.state.camera.zoom / 4) / 2;\r\n    return new Vec2D.Vector(this.state.camera.x + offX + config.TILESIZE * this.state.camera.zoom / 2,\r\n      this.state.camera.y + offY);\r\n  }\r\n\r\n\r\n  /**\r\n   * Handles mouse up and down events\r\n   * @param {The event that tirggered this callback} event \r\n   */\r\n  handleMouseClick = (event) => {\r\n    if (event.type === \"pointerdown\") {\r\n      this.setState({ isMouseDown: true });\r\n      let eX = event.data.global.x; let eY = event.data.global.y;\r\n      // saves the position last clicked;\r\n      this.setState({ lastX: eX, lastY: eY, lastDragX: eX, lastDragY: eY })\r\n    } else {\r\n      if (this.state.isMouseDown) { // click happened\r\n        let t = performance.now(); // for double click\r\n        let dT = t - this.state.lastClick;\r\n        this.setState({ isMouseDown: false , lastClick: t});\r\n        if(dT < 180) // double click if click happens to close to last one\r\n          this.handleDoubleClick(event)\r\n        else // normal click\r\n          this.handleClick(event, event.data.global.x, event.data.global.y);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * handles double click events\r\n   * @param {event} event the event that triggered the double click\r\n   */\r\n  handleDoubleClick(event) {\r\n    // double click with left mouse -> center map\r\n    if(event.data.button === 2)\r\n      this.center();\r\n  }\r\n\r\n  /**\r\n   * Handles mouse movements events\r\n   * @param {the event data} e \r\n   */\r\n  onMouseMove(e) {\r\n    e.stopPropagation();\r\n    //e.preventDefault()\r\n    let eX = e.data.global.x; let eY = e.data.global.y;\r\n    this.setState({ x: eX, y: eY });\r\n\r\n    if (this.state.isMouseDown) {\r\n      // drag event\r\n      if (e.data.buttons === 2) {\r\n        // calculates drag direction \r\n        const mousePos = new Vec2D.Vector(e.data.global.x, e.data.global.y);\r\n        const lastDrag = new Vec2D.Vector(this.state.lastDragX, this.state.lastDragY);\r\n        this.setState({ isDragging: true, lastDragX: eX, lastDragY: eY });\r\n        const offset = mousePos.subtract(lastDrag)\r\n        // adjusts camera accordingly\r\n        this.updateCamera(offset)\r\n      } else if (e.data.buttons === 1) { // if it is left click\r\n        if (this.state.isBuilding) // if it is building\r\n          this.placeBlock(); // delegate block placement to the method responsible for it\r\n      }\r\n    } else {\r\n      this.setState({ isDragging: false });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates camera's current position\r\n   * @param {offset to be added to the camera's current position} offset \r\n   */\r\n  updateCamera(offset) {\r\n    const camera = Object.assign({}, this.state.camera);\r\n    camera.x += offset.x;\r\n    camera.y += offset.y;\r\n    this.setState({ camera: camera });\r\n  }\r\n\r\n  /**\r\n   * Rotates board in the desired direction orientation\r\n   */\r\n  rotate(direction) {\r\n    const matrix = this.state.tiles.slice();\r\n    const oldCenterX = this.getCenter(matrix[0]).x;\r\n\r\n    const n = matrix.length;\r\n\r\n    if (direction === \"clockwise\") { // clockwise\r\n      for (let i = 0; i < n / 2; i++) {\r\n        for (let j = i; j < n - i - 1; j++) {\r\n          let tmp = matrix[i][j];\r\n          matrix[i][j] = matrix[n - j - 1][i];\r\n          matrix[n - j - 1][i] = matrix[n - i - 1][n - j - 1];\r\n          matrix[n - i - 1][n - j - 1] = matrix[j][n - i - 1];\r\n          matrix[j][n - i - 1] = tmp;\r\n        }\r\n      }\r\n    }\r\n    else { // anticlockwise\r\n      for (let i = 0; i < n / 2; i++) {\r\n        for (let j = i; j < n - i - 1; j++) {\r\n          let tmp = matrix[i][j];\r\n          matrix[i][j] = matrix[j][n - 1 - i];\r\n          matrix[j][n - 1 - i] = matrix[n - 1 - i][n - 1 - j];\r\n          matrix[n - 1 - i][n - 1 - j] = matrix[n - 1 - j][i];\r\n          matrix[n - 1 - j][i] = tmp;\r\n        }\r\n      }\r\n    };\r\n    const xOffset = this.getCenter(matrix).x - oldCenterX;\r\n    const camera = Object.assign({}, this.state.camera);\r\n    camera.x -= xOffset;\r\n    this.setState({ tiles: matrix, camera: camera });\r\n  }\r\n\r\n  /**\r\n   * Handles click interactions in the board tiles\r\n   * @param {e} e the event that triggered the click callback\r\n   * @param {the x coord of the click to be handled} x \r\n   * @param {the y coord of the click to be handled} y \r\n   */\r\n  handleClick(e, x, y) {\r\n    if (!this.state.isDragging && !this.state.isBuilding) {\r\n      const tiles = this.state.tiles.slice();\r\n\r\n      // dont mess with undefined\r\n      if (typeof tiles == \"undefined\")\r\n        return;\r\n\r\n      var idx = this.convertToMap(x, y);\r\n      var i = Math.floor(idx[0]);\r\n      var j = Math.floor(idx[1]);\r\n\r\n      // precision calculation to consider only the top plane of cube\r\n      let topFactor = this.getTopFactor(i, j, x, y);\r\n\r\n      // if it hits some existing block\r\n      if (tiles[i][j] !== 0) {\r\n\r\n        // Click on a valid cube plane!!! Success!!!!!\r\n        if (topFactor > 0 && topFactor <= 1) {\r\n          // tiles[i][j] = 0; // updates it\r\n          console.log(\"clicked on [\" + i + \", \" + j + \"]\");\r\n        }\r\n\r\n      }\r\n\r\n      // updates layers in game state\r\n      this.setState({ tiles: tiles });\r\n    } else if (this.state.isBuilding && e.data.button === 0) { // is in building mode (able to place blocks)\r\n      this.placeBlock();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Converts coordinates in the screen space (X,Y) of the page\r\n   * to the map coordinates (i,j)\r\n   * @param {The x - the x coordinate to be converted to map index j } screenX \r\n   * @param {The y - the y coordinate to be converted to map index i } screenY \r\n   * @param {*} limit if calculations should be limited by board boundaries (default = true)\r\n   */\r\n  convertToMap(screenX, screenY, limit = true) {\r\n    let TILESIZE_Z = config.TILESIZE * this.state.camera.zoom;\r\n    let TILE_HALF = TILESIZE_Z / 2;\r\n\r\n    let x = screenX - TILE_HALF - this.state.camera.x;\r\n    let y = screenY - this.state.camera.y;\r\n    let i = Math.trunc((y / TILE_HALF) - (x / TILESIZE_Z));\r\n    let j = Math.trunc((y / TILE_HALF) + (x / TILESIZE_Z));\r\n\r\n    // limits i and j to be inside board boundaries\r\n    if (limit) {\r\n      // makes sure we do not surpass the map 2darray limits\r\n      if (i < 0) i = 0; if (i >= this.state.tiles.length) i = this.state.tiles.length - 1;\r\n      if (j < 0) j = 0; if (j >= this.state.tiles[0].length) j = this.state.tiles[0].length - 1;\r\n    }\r\n\r\n    return [i, j];\r\n  }\r\n\r\n  /**\r\n   * Returns a value that indicates if a point is within\r\n   * the top plane of a given tile in the map\r\n   * (the factor indicates it is in top plane when its value is between 0 and 1)\r\n   * @param {*} i the i-index of the tile to be checked\r\n   * @param {*} j the j-index of the tile to be checked\r\n   * @param {*} screenX the x-index of the mouse click in the page\r\n   * @param {*} screenY the y-index of the mouse click in the page\r\n   * @returns factor that indicates if click is in top plane when its value is between 0 and 1 \r\n   *          or out of the top plane when it is not\r\n   */\r\n  getTopFactor(i, j, screenX, screenY) {\r\n    /**\r\n    * tx,ty: coordinates of the tile in page (top-left orientation)\r\n    * tcx,tcy: coordinates of the middle of the tile\r\n    * cx, cy: coordinates of the click in the page\r\n    * offsetX,Y: offset relation between click and middle of the tile\r\n    * topFactor: factor from that indicates when click is on the top plane of cube (from 0 to 1 = click in top plane)\r\n    */\r\n    let tx = (j - i) * (config.TILESIZE * this.state.camera.zoom / 2) + this.state.camera.x;\r\n    let ty = (i + j) * (config.TILESIZE * this.state.camera.zoom / 4) + this.state.camera.y;\r\n    let cx = screenX;\r\n    let cy = screenY;\r\n    let tcy = ty + (config.TILESIZE * this.state.camera.zoom / 4);\r\n    let tcx = tx + (config.TILESIZE * this.state.camera.zoom / 2);\r\n    let offsetY = Math.abs(cy - tcy) * 2;\r\n    let offsetX = Math.abs(cx - tcx);\r\n    return (offsetX + offsetY) / ((config.TILESIZE * this.state.camera.zoom / 4) + (config.TILESIZE * this.state.camera.zoom / 4));\r\n  }\r\n\r\n  /**\r\n   * Renders the tile\r\n   * @param {The i-index of the tile} i \r\n   * @param {The j-index of the tile} j \r\n   */\r\n  renderTile(i, j, key) {\r\n    return (\r\n      <Tile\r\n        value={this.state.tiles[i][j]}\r\n        key={key}\r\n        camera={this.state.camera}\r\n        zIndex={i + j + 2}\r\n        top={(i + j) * (config.TILESIZE * this.state.camera.zoom / 4) + this.state.camera.y}\r\n        left={(j - i) * (config.TILESIZE * this.state.camera.zoom / 2) + this.state.camera.x}\r\n      />\r\n    )\r\n\r\n  }\r\n\r\n  // renders projection ofselected tile on tilemap on mouse move position\r\n  // and updates placement position valid candidates in case of user click\r\n  updateProjection() {\r\n    const tiles = this.state.tiles.slice();\r\n    const mX = this.state.x;\r\n    const mY = this.state.y;\r\n    var top = mY - this.state.camera.zoom * config.TILESIZE / 4;\r\n    var left = mX - this.state.camera.zoom * config.TILESIZE / 2;\r\n    var alpha = 0.5;\r\n    var blendMode = PIXI.BLEND_MODES.NORMAL;\r\n    var tint = 0xFFFFFF;\r\n    // placement position (null if not valid)\r\n    var placeI = null; var placeJ = null; var zIndex = 2147483646;\r\n\r\n    var idx = this.convertToMap(this.state.x, this.state.y);\r\n    var i = Math.floor(idx[0]);\r\n    var j = Math.floor(idx[1]);\r\n\r\n    // precision calculation\r\n    let topFactor = this.getTopFactor(i, j, this.state.x, this.state.y);\r\n\r\n    if (tiles[i][j] !== 0) {  // borders of board\r\n      if (topFactor >= 1 && topFactor <= 3) { // is within acceptable distance of border and has neighbour\r\n        idx = this.convertToMap(this.state.x, this.state.y, false); // gets position \r\n        i = Math.floor(idx[0]);\r\n        j = Math.floor(idx[1]);\r\n        const oldI = i; const oldJ = j; // stores preprojection pos with limit at 0\r\n\r\n        if (1 / i === -Infinity) i--; // correction to project with i < 0\r\n        if (1 / j === -Infinity) j--; // correction to project with j < 0\r\n\r\n        if (!this.isAtCorner(i, j)) {\r\n          top = (i + j) * (config.TILESIZE * this.state.camera.zoom / 4) + this.state.camera.y\r\n          left = (j - i) * (config.TILESIZE * this.state.camera.zoom / 2) + this.state.camera.x\r\n          alpha = 0.5; blendMode = PIXI.BLEND_MODES.ADD; tint = 0x46ff00;\r\n          placeI = oldI; placeJ = oldJ; // updates placement indexes with a valid placement position\r\n          zIndex = i + j + 2;\r\n        }\r\n      }\r\n    } else { // empty slot is a valid position if there is a neighbour tile\r\n      const hasNeighbour = this.hasNeighbour(i, j);\r\n\r\n      // if is within the projected top plane of cube to be placed and has a neighbour\r\n      if (topFactor > 0 && topFactor <= 1 && hasNeighbour) {\r\n        //console.log(\"Im a valid poisition to place block\");\r\n        top = (i + j) * (config.TILESIZE * this.state.camera.zoom / 4) + this.state.camera.y\r\n        left = (j - i) * (config.TILESIZE * this.state.camera.zoom / 2) + this.state.camera.x\r\n        alpha = 0.5; blendMode = PIXI.BLEND_MODES.ADD; tint = 0x46ff00;\r\n        placeI = i; placeJ = j; // updates placement indexes with a valid placement position\r\n        zIndex = i + j + 2;\r\n      }\r\n    }\r\n\r\n    // updates block data\r\n    const block = Object.assign({}, this.state.block);\r\n    block.placeI = placeI; block.placeJ = placeJ; block.tint = tint; block.alpha = alpha;\r\n    block.x = left; block.y = top; block.zIndex = zIndex; block.blendMode = blendMode;\r\n    this.setState({block:block});\r\n  }\r\n\r\n  /**\r\n   * Return if a tile in a given position (i,j) has a valid neighbour (value != 0)\r\n   * @param {*} i the i-index of the tile to check neighbours\r\n   * @param {*} j the j-index of the tile to check neighbours\r\n   */\r\n  hasNeighbour(i, j) {\r\n    const tiles = this.state.tiles.slice();\r\n    const left = j - 1 >= 0 ? (tiles[i][j - 1] !== 0 ? true : false) : false;\r\n    const right = j + 1 < tiles[i].length ? (tiles[i][j + 1] !== 0 ? true : false) : false;\r\n    const up = i - 1 >= 0 ? (tiles[i - 1][j] !== 0 ? true : false) : false;\r\n    const down = i + 1 < tiles.length ? (tiles[i + 1][j] !== 0 ? true : false) : false;\r\n    return left || right || up || down;\r\n  }\r\n\r\n  /**\r\n   * Check if it is at the corner of board (outside tiles that are attached to one of the four board corners)\r\n   * @param {*} i the i-index of the tile to check if it is at board boundaries corner\r\n   * @param {*} j the j-index of the tile to check if it is at board boundaries corner\r\n   */\r\n  isAtCorner(i, j) {\r\n    const tiles = this.state.tiles.slice();\r\n    const upLeft = j === -1 ? (i === -1 ? true : false) : false;\r\n    const upRight = j === tiles[0].length ? (i === -1 ? true : false) : false;\r\n    const downLeft = j === -1 ? (i === tiles.length ? true : false) : false;\r\n    const downRight = j === tiles[0].length ? (i === tiles.length ? true : false) : false;\r\n    return upLeft || upRight || downLeft || downRight;\r\n  }\r\n\r\n  /**\r\n   * changes related to the building mode\r\n   */\r\n  toggleBuild() {\r\n    this.state.isBuilding ? this.setState({ isBuilding: false }) : this.setState({ isBuilding: true });\r\n  }\r\n\r\n  /**\r\n   * Place block in the stored placement position\r\n   */\r\n  placeBlock() {\r\n    let i = this.state.block.placeI; let j = this.state.block.placeJ;\r\n    let valid = i != null ? (j != null ? (i >= 0 ? (j >= 0 ? (i < config.BOARD_SIZE ?\r\n      (j < config.BOARD_SIZE ? true : false) : false)\r\n      : false) : false) : false) : false;\r\n    if (valid) { // has a valid place to place block\r\n      const tiles = this.state.tiles.slice();\r\n      tiles[i][j] = this.state.block.selectedTile;\r\n      this.setState({ tiles: tiles });\r\n    }\r\n  }\r\n\r\n  // change zoom based on mwheel\r\n  onWheel(e) {\r\n    let scroll = -e.deltaY / 3200;\r\n\r\n    if ((this.state.camera.zoom + scroll) > this.state.camera.min_zoom &&\r\n      (this.state.camera.zoom + scroll) <= this.state.camera.max_zoom) {\r\n      const camera = Object.assign({}, this.state.camera);\r\n      const oldZoom = camera.zoom;\r\n      camera.zoom += scroll;\r\n      const newZoom = camera.zoom;\r\n      const oldHeight = config.TILESIZE * config.BOARD_SIZE * oldZoom;\r\n      const newHeight = config.TILESIZE * config.BOARD_SIZE * newZoom;\r\n      const dH = newHeight - oldHeight;\r\n      camera.y = camera.y - dH / 4;\r\n      this.setState({ camera: camera });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div>\r\n        <div className='game-board'> \r\n          <PixiComponent onMouseDown={this.handleMouseClick}\r\n            onMouseUp={this.handleMouseClick}\r\n            onMouseMove={this.onMouseMove.bind(this)}\r\n            onWheel={this.onWheel.bind(this)}\r\n            onBuildingBtn={this.toggleBuild.bind(this)}\r\n            onRotateAntiBtn={() => this.rotate(\"anticlockwise\")}\r\n            onCenterBtn={this.center.bind(this)}\r\n            onRotateBtn={() => this.rotate(\"clockwise\")}\r\n            updateProjection={this.updateProjection.bind(this)}\r\n            state={this.state} />\r\n        </div>\r\n        {/* <button className=\"rotate-button\" onClick={() => this.rotate(\"anticlockwise\")}>Anti-clockwise</button>\r\n        <button className=\"rotate-button\" onClick={() => this.rotate(\"clockwise\")}>Clockwise</button>\r\n        <button className=\"center-button\" onClick={() => this.center()}>Center</button> */}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Called when component is mounted\r\n   */\r\n  componentDidMount() {\r\n    window.addEventListener('resize', this.resize);\r\n    this.forceUpdate();\r\n    //this.loadTiles(); // load initial tiles\r\n  }\r\n\r\n  /**\r\n   * Called when component is unmounted\r\n   */\r\n  componentWillUnmount() {\r\n    window.removeEventListener('resize', this.resize);\r\n  }\r\n}\r\n\r\nexport default Board;\r\n\r\n\r\n/**\r\n * Creates and fills multidimensional arrays with\r\n * a default value\r\n * Mohammed Ashfaq @ StackOverflow\r\n * @param rows The number of rows for the array\r\n * @param columns The number of columns for the array\r\n * @param defaultValue The default value for each field of the array\r\n * @returns The newly created multidimensional array populated with the default value\r\n */\r\n// function createAndFill2DArray({rows, columns, defaultValue}){\r\n//     return Array.from({ length:rows }, (e, i) => (\r\n//     Array.from({ length:columns }, (e, j)=> defaultValue)));\r\n// }","/**\r\n * Worker listener for loading tasks\r\n */\r\nconst workercode = () => {\r\n    onmessage = function (e) {\r\n        /**\r\n         * Creates a new game board represented by a 2d array\r\n         * @param rows The number of rows for the array\r\n         * @param columns The number of columns for the array\r\n         * @param defaultValue The default value for each field (0 for empty)\r\n         * @returns The newly created multidimensional array populated with the initial disposition of the board\r\n         */\r\n        if (e.data.cmd === \"loadMap\") {\r\n            // progress\r\n            var PROGRESS_BOARD_LOAD = 0;\r\n            // get params\r\n            const rows = e.data.rows; const columns = e.data.columns; const defaultValue = e.data.defaultValue;\r\n            // creates game array as one dimension for faster message transfer\r\n            const tiles = new Uint8Array(rows*columns);\r\n            // count for the progress calculation\r\n            var count = 0;\r\n\r\n            // fills array with default value\r\n            for (let i = 0; i < rows; i++) {\r\n                for (let j = 0; j < columns; j++) {\r\n                    tiles[count] = defaultValue;\r\n                    // updates count\r\n                    count++;\r\n                    // send message to main UI thread in case progress changes\r\n                    let cProgress =  Math.round(100 * (count / (rows * columns)));\r\n                    if(cProgress !== PROGRESS_BOARD_LOAD)\r\n                        self.postMessage({'cmd': 'updateProgress', 'progress' : cProgress}); // eslint-disable-line no-restricted-globals\r\n                    // updates loading progress\r\n                    PROGRESS_BOARD_LOAD = cProgress;\r\n                }\r\n            }\r\n            // send the newly created board\r\n            self.postMessage({cmd:'receiveBoard', tiles: tiles.buffer}, [tiles.buffer]); // eslint-disable-line no-restricted-globals\r\n            //self.postMessage(tiles.buffer, [tiles.buffer]); // eslint-disable-line no-restricted-globals\r\n        }\r\n    };\r\n};\r\n\r\nlet code = workercode.toString();\r\ncode = code.substring(code.indexOf(\"{\") + 1, code.lastIndexOf(\"}\"));\r\n\r\nconst blob = new Blob([code], { type: \"application/javascript\" });\r\nconst worker_script = URL.createObjectURL(blob);\r\n\r\nexport function getWorkerScript() { return worker_script }\r\n\r\n\r\n// returns board creation progress\r\n//export function getProgressBoardLoad() { return PROGRESS_BOARD_LOAD; }","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport Board from './board.js';\r\nimport Config from './config.json';\r\nimport * as Load from './load.js';\r\nimport {FpsView} from \"react-fps\";\r\n\r\nexport const STATE_LOADING = 1;\r\nexport const STATE_RUNNING = 2;\r\n\r\nclass Game extends React.Component {\r\n  \r\n  constructor(props) {\r\n    super(props);\r\n    document.body.style.overflow = 'hidden';\r\n    window.addEventListener(\"contextmenu\", e => e.preventDefault());\r\n    this.state = {\r\n      loadProgress: 0,\r\n      loadText: \"Loading map...\",\r\n      current: STATE_LOADING,\r\n      tiles: null,\r\n      isNewBoard: true\r\n    }\r\n  }\r\n  \r\n  // load game components on mount\r\n  componentDidMount () {\r\n    this.loadBoard();\r\n  }\r\n\r\n  // transform an array into a 2d array/matrix\r\n  matrixify (arr, rows, cols) {\r\n    var matrix = [];\r\n    if (rows * cols === arr.length) {\r\n        for(var i = 0; i < arr.length; i+= cols) {\r\n            matrix.push(arr.slice(i, cols + i));\r\n        }\r\n    }\r\n\r\n    return matrix;\r\n};\r\n  \r\n  /**\r\n   * Loads game board by creating a worker to do the job\r\n   * while update UI until receiving the finished data\r\n   */\r\n  loadBoard() {\r\n    if (window.Worker) {\r\n      // creates worker\r\n      this.boardWorker = new Worker(Load.getWorkerScript());\r\n      // send load map message\r\n      this.boardWorker.postMessage({'cmd': 'loadMap', 'rows': Config.BOARD_SIZE, 'columns': Config.BOARD_SIZE, 'defaultValue': 0});\r\n      this.boardWorker.onmessage = e => {\r\n        if(e.data.cmd === \"updateProgress\")\r\n          this.setState({loadProgress: e.data.progress});\r\n        else  if(e.data.cmd === \"receiveBoard\"){\r\n          const tiles = new Uint8Array(e.data.tiles); // gets board as an Uint8Array to be converted to a matrix and stored\r\n          this.setState({tiles: this.matrixify(tiles, Config.BOARD_SIZE, Config.BOARD_SIZE), current:STATE_RUNNING});\r\n        }\r\n      };\r\n\r\n    }\r\n\r\n\r\n   // while(true) console.log(Load.getProgressBoardLoad());\r\n    //this.setState({current:STATE_RUNNING, tiles:tiles});\r\n  }\r\n\r\n  /**\r\n   * Renders the game based on current state\r\n   */\r\n  render() {\r\n    // switch states to get content\r\n    var content = null;\r\n\r\n    switch(this.state.current) {\r\n      case STATE_LOADING:\r\n        content = this.renderLoadingScreen();\r\n        break;\r\n      case STATE_RUNNING:\r\n        content = this.renderBoard();  \r\n        break;\r\n      default:\r\n        console.log(\"Unknown game state: Game state must be one of the defined ones\");\r\n        break;\r\n    }\r\n     return content;\r\n  }\r\n\r\n  // Renders Board\r\n  renderBoard() {\r\n    return (\r\n      <div className=\"game\" >\r\n        <div>\r\n          <Board tiles={this.state.tiles} isNewBoard={this.state.isNewBoard}/>\r\n        </div>\r\n        <div className=\"game-info\">\r\n          <FpsView width={40} height={10} left={0} top={0}/>\r\n          <div>{/* status */}</div>\r\n          <ol>{/* TODO */}</ol>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Loads game and render loading screen\r\n  renderLoadingScreen() {\r\n    return (\r\n      <div className=\"game\" >\r\n        <div>\r\n          {this.state.loadText} ({this.state.loadProgress})\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n}\r\n\r\n// ========================================\r\n\r\nReactDOM.render(\r\n  <Game />,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}